#!/data/data/com.termux/files/usr/bin/bash

G='\e[32m'
B='\e[34m'
R='\e[31m'
N='\e[0m'

echo -e "${G}[*] Настройка окружения для Go GUI...${N}"

# 1. Системные пакеты (Go + библиотеки для графики)
PKGS=("golang" "termux-api" "pkg-config" "x11-repo")
echo -e "${B}[*] Установка системных пакетов...${N}"
pkg update -y
pkg install -y "${PKGS[@]}"
pkg install -y libx11 libxcursor libxinerama libxrandr libxi mesa

mkdir -p ~/.termux
if ! grep -q "allow-external-apps=true" ~/.termux/termux.properties; then
    echo "allow-external-apps=true" >> ~/.termux/termux.properties
    termux-reload-settings
fi

# 4. Подготовка Go проекта
echo -e "${B}[*] Загрузка зависимостей Go (Fyne)...${N}"
if [ ! -f "go.mod" ]; then
    go mod init meow_chat
fi
go get fyne.io/fyne/v2

# 5. Компиляция (тестовая сборка под текущую систему)
echo -e "${B}[*] Компиляция бинарного файла...${N}"
if go build -o meow_gui main.go; then
    echo -e "${G}[OK] Установка завершена! Запуск: ./meow_gui${N}"
else
    echo -e "${R}[-] Ошибка компиляции! Проверь наличие main.go${N}"
    exit 1
fi
